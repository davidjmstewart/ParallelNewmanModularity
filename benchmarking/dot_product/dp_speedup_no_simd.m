clear all;
close all;

fig = figure;
matrix_sizes = [128, 256, 512, 1024, 2048, 4096, 8192, 16384];
% matrix_sizes = [1000000, 2000000, 3000000, 4000000];

parallel_timings_no_simd = [
    0.000007310  0.001186518  0.000854837  0.000999193  0.001238327  0.001822282  0.002954042  0.003849761 
    0.000003947  0.001194130  0.000863951  0.000905163  0.001260733  0.001982367  0.003035395  0.003798408 
    0.000009098  0.001225673  0.000890659  0.000944577  0.001303663  0.001827452  0.003070567  0.003572027 
    0.000006133  0.001108160  0.000709874  0.000793300  0.000953757  0.001434599  0.002580672  0.003457066 
    0.000014296  0.001040956  0.000777803  0.000808790  0.001093883  0.001563540  0.002698922  0.003565872 
    0.000016794  0.001155610  0.000810713  0.000843992  0.001183764  0.001920884  0.003079461  0.003762442 
    0.000032203  0.001218890  0.000771517  0.000982802  0.001372581  0.002134785  0.003156579  0.003955854 
    0.000056435  0.001176451  0.000898729  0.000951198  0.001279858  0.002016375  0.003250232  0.003966899 
];

T = [1: 8];

sequential_averages_no_simd = [
    0.000000340 
    0.000000686 
    0.000002194 
    0.000001960 
    0.000004830 
    0.000021241 
    0.000029335 
    0.000037936
];

parallel_timings_with_simd = [
    0.000014032  0.001086531  0.000820205  0.000913657  0.001085351  0.001788339  0.002834302  0.003807582 
    0.000006873  0.001035055  0.000705993  0.000840783  0.001080155  0.001650537  0.002852693  0.003442119 
    0.000004134  0.001081599  0.000685287  0.000740752  0.000944530  0.001519600  0.002588153  0.003395759 
    0.000004126  0.001111127  0.000722837  0.000797643  0.001091285  0.001615246  0.002707259  0.003537308 
    0.000007570  0.001069705  0.000728351  0.000788393  0.001059309  0.001537497  0.002866619  0.003683473 
    0.000015651  0.001091885  0.000696341  0.000792755  0.001101046  0.001571689  0.002799117  0.003615242 
    0.000013044  0.001146818  0.000702253  0.000768215  0.000927106  0.001441818  0.002500459  0.003464694 
    0.000015399  0.001036618  0.000673370  0.000717986  0.000953891  0.001414702  0.002567839  0.003426806 
];

T = [1: 8];

sequential_averages_with_simd = [
    0.000000294 
    0.000000540 
    0.000001009 
    0.000002583 
    0.000007043 
    0.000009603 
    0.000022500 
    0.000037989 
];

sequential_averages_with_simd_no_threading = [
    0.000000294 
    0.000000540 
    0.000001009 
    0.000002583 
    0.000007043 
    0.000009603 
    0.000022500 
    0.000037989 
];


parallel_averages_with_simd_no_threading = [
    0.000000074
    0.000000113
    0.000000188
    0.000000347
    0.000000709
    0.000001405
    0.000002720
    0.000005496
];

for i = 1:size(parallel_timings_no_simd, 1)
    subplot(4,2,i); 
    hold on;
    grid on;
    grid minor;
    c_no_simd = plot(T, parallel_timings_no_simd(i,:).^-1 * sequential_averages_no_simd(i), 'LineWidth', 2);
    title(sprintf('%d element Vector',matrix_sizes(i)),'interpreter','latex','fontsize',12);
    set(gca,'TickLabelInterpreter','latex');
end
handle=axes(fig,'visible','off'); 
handle.XLabel.Visible='on';
handle.XLabel.Interpreter = 'latex';

handle.YLabel.Visible='on';
handle.Title.Visible='on';
ylabel(handle,'Speedup','interpreter','latex','fontsize',16);
xlabel(handle,'Number of threads','interpreter','latex','fontsize',16);
title(handle,'\textbf{Speedup of parallelising dot product computation with OpenMP}','interpreter','latex','fontsize',12);
handle.Title.Position(2) = 1.05